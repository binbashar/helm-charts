#
# Project metadata
#
metadata:
  org: "binbash.com.ar/devops/"
  maintainer: "DevOps (devops@binbash.com.ar)"
  description: "Desired state file for Binbash DEVELOPMENT environment."


#
# Kubectl, Helm and Helmsman settings
#
settings:
  kubeContext: "cluster-eks-1.k8s.dev.binbash.aws"    # Will try connect to this context first, otherwise, it will be created
  storageBackend: "secret"                           # Use secret for storage, default is configMap
  tillerless: true                                   # Run helm in tillerless mode


#
# Helm Repositories
#
helmRepos:
  stable: "https://kubernetes-charts.storage.googleapis.com"
  incubator: "http://storage.googleapis.com/kubernetes-charts-incubator"
  jetstack: "https://charts.jetstack.io"
  linkerd: "https://helm.linkerd.io/stable"


#
# Define below the namespaces that will be used by the charts
#
namespaces:
  kube-system:
    installTiller: false

  monitoring:
    protected: false        # Protect this from deletion?
    installTiller: false    # Do not install Tiller on the cluster
    labels:                 # Add useful labels to this namespace
      env: "aws-eks-dev"

  linkerd:
    protected: true
    installTiller: false
    labels:
      env: "aws-eks-dev"

  nginx-ingress:
    installTiller: false
    labels:
      env: "aws-eks-dev"

  cert-manager:
    installTiller: false
    labels:
      env: "aws-eks-dev"

  fluentd:
    installTiller: false
    labels:
      env: "aws-eks-dev"
      
  tracing:
    installTiller: false
    labels:
      env: "aws-eks-dev"
      
  utilities:
    installTiller: false
    labels:
      env: "aws-eks-dev"


#
# Define below the charts that will be deployed on this environment
#
apps:
  kube-job-cleaner:
    namespace: devops-utils                         # Maps to the namespace defined in the namespaces section above
    enabled: true                                   # Set to false if you want to delete this app release
    chart: ../charts/kube-job-cleaner/              # Local path to the chart; or chart name if you use one from a repository
    version: 0.1.0                                  # Which version to deploy
    name: kube-job-cleaner                          # This should be unique across all apps
    description: kube-job-cleaner                   # Just a nice description
    valuesFile: ./kube-job-cleaner/values.yaml      # Override default chart values
    purge: true                                     # Make helm purge this release when it is removed

  onetimesecret:
    namespace: utilities
    enabled: true
    chart: ../../@local-charts/onetimesecret/
    version: 0.1.1
    name: onetimesecret
    description: OneTimeSecret
    valuesFiles:
      - ./onetimesecret/values.yaml
      - ./onetimesecret/secrets.dec.yaml
    purge: true

  kube-state-metrics:
    namespace: monitoring
    enabled: true
    chart: stable/kube-state-metrics
    version: 2.3.1
    name: kube-state-metrics
    description: Kubernetes State Metrics
    valuesFile: "./kube-state-metrics/values.yaml"
    purge: true
    protected: false

  node-exporter:
    namespace: monitoring
    enabled: true
    chart: stable/prometheus-node-exporter
    version: 1.6.0
    name: node-exporter
    description: Prometheus Node Exporter
    valuesFile: ./node-exporter/values.yaml
    purge: true

  aws-iam-authenticator-config:
    namespace: kube-system
    enabled: true
    chart: ../../@local-charts/aws-iam-authenticator-config
    version: 0.1.0
    name: aws-iam-authenticator-config
    description: AWS IAM Authenticator Mapping Configuration
    valuesFile: "./aws-iam-authenticator-config/values.yaml"
    purge: true
    protected: false

  linkerd2:
    namespace: linkerd
    enabled: true
    chart: linkerd/linkerd2
    version: 2.6.0
    name: linkerd2
    description: Linkerd2
    valuesFile: ./linkerd2/secrets.dec.yaml
    purge: true

  nginx-ingress-test:
    namespace: nginx-ingress
    enabled: true
    chart: stable/nginx-ingress
    version: 1.20.0
    name: nginx-ingress-test
    description: nginx-ingress with a public facing NLB for dev/stg environment
    valuesFile: ./nginx-ingress/values.yaml
    purge: true
    
  nginx-ingress-test-internal:
    namespace: nginx-ingress
    enabled: true
    chart: stable/nginx-ingress
    version: 1.20.0
    name: nginx-ingress-test-internal
    description: An nginx-ingress with an internal NLB for test environment
    valuesFile: ./nginx-ingress-internal/values.yaml
    purge: true

  cert-manager-crds:
    namespace: cert-manager
    enabled: true
    wait: true
    timeout: 90
    priority: -100
    chart: ../../@local-charts/cert-manager-crds
    version: 0.1.0
    name: cert-manager-crds
    description: cert-manager CRDs (prerequisite of cert-manager)
    purge: true

  cert-manager:
    namespace: cert-manager
    enabled: true
    protected: true
    priority: -50
    chart: jetstack/cert-manager
    version: 0.10.0
    name: cert-manager
    description: cert-manager
    valuesFile: ./cert-manager/values.yaml
    purge: true

  cluster-issuer-binbash:
    namespace: cert-manager
    enabled: true
    priority: -25
    chart: ../../@local-charts/cert-manager-issuer
    version: 0.1.0
    name: cluster-issuer-binbash
    description: Cert-manager ClusterIssuer for binbash.com.ar
    valuesFile: ./cluster-issuer-binbash/secrets.dec.yaml
    purge: true

  fluentd:
    namespace: fluentd
    enabled: true
    chart: ../../@local-charts/fluentd-daemonset
    version: 0.1.0
    name: fluentd
    description: FluentD
    valuesFile: ./fluentd-daemonset/values.yaml
    purge: true

  jaeger:
    namespace: tracing
    enabled: true
    chart: ../../@local-charts/jaeger
    version: 0.1.0
    name: jaeger
    description: Jaeger Distributed Tracing
    valuesFile: ./jaeger/values.yaml
    purge: true

  opencensus:
    namespace: tracing
    enabled: true
    chart: ../../@local-charts/opencensus
    version: 0.1.0
    name: opencensus
    description: OpenCensus Collector
    valuesFile: ./opencensus/values.yaml
    purge: true
